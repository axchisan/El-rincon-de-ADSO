{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "nixpacksPlan": {
      "phases": {
        "setup": {
          "nixPkgs": ["php", "php-fpm", "php83Extensions.pgsql", "nginx"]
        },
        "build": {
          "cmd": "mkdir -p /var/log/nginx /var/cache/nginx /run/nginx /run/php-fpm /var/log/php-fpm /etc/php-fpm.d && chmod -R 777 /var/log /run && echo 'server { listen 0.0.0.0:$PORT; root /app; index index.php; access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; location / { try_files $uri $uri/ /src/frontend/inicio/index.php?$args; } location ~ \\.php$ { include fastcgi_params; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; } location ~* \\.(jpg|jpeg|png|gif|ico|css|js|pdf|woff|woff2|ttf|svg|eot|mp4|webm|ogg)$ { expires max; log_not_found off; } }' > /etc/nginx/nginx.conf && echo '[global] error_log = /var/log/php-fpm.log pid = /run/php-fpm.pid include=/etc/php-fpm.d/*.conf' > /etc/php-fpm.conf && echo '[global] daemonize = no [www] listen = 127.0.0.1:9000 user = nobody group = nobody pm = dynamic pm.max_children = 5 pm.start_servers = 2 pm.min_spare_servers = 1 pm.max_spare_servers = 3' > /etc/php-fpm.d/www.conf"
        },
        "start": {
          "cmd": "php-fpm -y /etc/php-fpm.conf -D && nginx -g 'daemon off;'"
        }
      }
    },
    "deploy": {
      "rootDirectory": "",
      "startCommand": "php-fpm -y /etc/php-fpm.conf -D && nginx -g 'daemon off;'",
      "restartPolicy": "ON_FAILURE"
    }
  }
}